# ğŸ”§ ç¿»è¯‘+å¯¼å…¥æ—¶åºé—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š"ç¿»è¯‘+å¯¼å…¥"åŠŸèƒ½æœ‰bugï¼Œå¯¼å…¥çš„Ankiå¡ç‰‡æ˜¯ä¸Šä¸€ä¸ªå•è¯ï¼Œè€Œä¸æ˜¯å½“å‰è¾“å…¥çš„å•è¯ã€‚

### å…·ä½“åœºæ™¯
1. ç”¨æˆ·è¾“å…¥ `consequence` å¹¶ç¿»è¯‘
2. ç”¨æˆ·è¾“å…¥ `comparability` å¹¶ç‚¹å‡»"ç¿»è¯‘+å¯¼å…¥"
3. **é—®é¢˜**: å¯¼å…¥åˆ°Ankiçš„æ˜¯ `consequence` è€Œä¸æ˜¯ `comparability`

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
è¿™æ˜¯ä¸€ä¸ª**å¼‚æ­¥æ—¶åºé—®é¢˜**ï¼š

```python
def translate_and_import(self):
    # å¯åŠ¨å¼‚æ­¥ç¿»è¯‘
    self.smart_translate()
    
    # ç«‹å³æ£€æŸ¥ç¿»è¯‘ç»“æœ - é—®é¢˜åœ¨è¿™é‡Œï¼
    if self.current_translation:  # è¿™é‡Œæ£€æŸ¥çš„æ˜¯ä¸Šä¸€æ¬¡çš„ç¿»è¯‘ç»“æœ
        self.root.after(1000, self.add_to_anki)  # å¯¼å…¥ä¸Šä¸€æ¬¡çš„ç»“æœ
```

### æ—¶åºåˆ†æ
```
æ—¶é—´çº¿:
T0: ç”¨æˆ·ç‚¹å‡»"ç¿»è¯‘+å¯¼å…¥"
T1: è°ƒç”¨ smart_translate() - å¯åŠ¨åå°ç¿»è¯‘çº¿ç¨‹
T2: ç«‹å³æ£€æŸ¥ current_translation - æ­¤æ—¶æ˜¯ä¸Šä¸€æ¬¡çš„ç»“æœï¼
T3: å®‰æ’å¯¼å…¥ä»»åŠ¡ - å¯¼å…¥ä¸Šä¸€æ¬¡çš„ç»“æœ
T4: åå°ç¿»è¯‘å®Œæˆ - æ›´æ–° current_translation (å¤ªæ™šäº†)
T5: æ‰§è¡Œå¯¼å…¥ - å¯¼å…¥çš„æ˜¯é”™è¯¯çš„å†…å®¹
```

## ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ è‡ªåŠ¨å¯¼å…¥æ ‡å¿—
```python
# åœ¨ __init__ ä¸­æ·»åŠ 
self.auto_import_after_translation = False
```

### 2. é‡æ–°è®¾è®¡ translate_and_import æ–¹æ³•
```python
def translate_and_import(self):
    """ä¸€é”®ç¿»è¯‘å¹¶å¯¼å…¥åˆ°Anki"""
    text = self.input_entry.get().strip()
    if not text:
        messagebox.showwarning("æç¤º", "è¯·è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹")
        return
    
    # è®¾ç½®è‡ªåŠ¨å¯¼å…¥æ ‡å¿—
    self.auto_import_after_translation = True
    
    # æ‰§è¡Œç¿»è¯‘
    self.smart_translate()
```

### 3. åœ¨ç¿»è¯‘å®Œæˆåæ£€æŸ¥è‡ªåŠ¨å¯¼å…¥
```python
def _do_smart_translation(self, text, category, info):
    """æ‰§è¡Œæ™ºèƒ½ç¿»è¯‘ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­ï¼‰"""
    try:
        # ... ç¿»è¯‘é€»è¾‘ ...
        
        if result:
            self.current_translation = {
                'input': text,
                'category': category,
                'info': info,
                'result': result
            }
            
            # æ›´æ–°UI
            self.root.after(0, lambda: self.display_result(result, category, info))
            
            # æ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨å¯¼å…¥ - å…³é”®ä¿®å¤ç‚¹
            if self.auto_import_after_translation:
                self.auto_import_after_translation = False  # é‡ç½®æ ‡å¿—
                # å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿UIæ›´æ–°å®Œæˆï¼Œç„¶åè‡ªåŠ¨å¯¼å…¥
                self.root.after(500, self.add_to_anki)
        else:
            self.auto_import_after_translation = False  # é‡ç½®æ ‡å¿—
            # ... é”™è¯¯å¤„ç† ...
            
    except Exception as e:
        self.auto_import_after_translation = False  # é‡ç½®æ ‡å¿—
        # ... å¼‚å¸¸å¤„ç† ...
```

## ä¿®å¤åçš„æ—¶åº

```
ä¿®å¤åæ—¶åº:
T0: ç”¨æˆ·ç‚¹å‡»"ç¿»è¯‘+å¯¼å…¥"
T1: è®¾ç½® auto_import_after_translation = True
T2: è°ƒç”¨ smart_translate() - å¯åŠ¨åå°ç¿»è¯‘çº¿ç¨‹
T3: åå°ç¿»è¯‘è¿›è¡Œä¸­...
T4: ç¿»è¯‘å®Œæˆ - æ›´æ–° current_translation (å½“å‰å•è¯)
T5: æ£€æŸ¥ auto_import_after_translation æ ‡å¿— - True
T6: é‡ç½®æ ‡å¿—ä¸º False
T7: å®‰æ’å¯¼å…¥ä»»åŠ¡ - å¯¼å…¥å½“å‰ç¿»è¯‘ç»“æœ
T8: æ‰§è¡Œå¯¼å…¥ - å¯¼å…¥æ­£ç¡®çš„å†…å®¹ âœ…
```

## å…³é”®æ”¹è¿›ç‚¹

### 1. åŒæ­¥é—®é¢˜è§£å†³
- **ä¿®å¤å‰**: åœ¨ç¿»è¯‘å¼€å§‹æ—¶å°±æ£€æŸ¥ç»“æœ
- **ä¿®å¤å**: åœ¨ç¿»è¯‘å®Œæˆåæ‰æ£€æŸ¥æ˜¯å¦éœ€è¦å¯¼å…¥

### 2. æ•°æ®ä¸€è‡´æ€§ä¿è¯
- **ä¿®å¤å‰**: å¯èƒ½å¯¼å…¥è¿‡æœŸçš„ç¿»è¯‘ç»“æœ
- **ä¿®å¤å**: ç¡®ä¿å¯¼å…¥æœ€æ–°çš„ç¿»è¯‘ç»“æœ

### 3. çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- **ä¿®å¤å‰**: æ²¡æœ‰çŠ¶æ€æ ‡å¿—ï¼Œä¾èµ–æ—¶é—´å»¶è¿Ÿ
- **ä¿®å¤å**: ä½¿ç”¨æ ‡å¿—ä½ç²¾ç¡®æ§åˆ¶å¯¼å…¥æ—¶æœº

### 4. é”™è¯¯å¤„ç†å®Œå–„
- **ä¿®å¤å‰**: å¼‚å¸¸æƒ…å†µä¸‹å¯èƒ½çŠ¶æ€æ··ä¹±
- **ä¿®å¤å**: æ‰€æœ‰å¼‚å¸¸è·¯å¾„éƒ½é‡ç½®æ ‡å¿—

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨æ™ºèƒ½ç¿»è¯‘å™¨
2. è¾“å…¥ `consequence`ï¼Œç‚¹å‡»"æ™ºèƒ½ç¿»è¯‘"
3. è¾“å…¥ `comparability`ï¼Œç‚¹å‡»"ç¿»è¯‘+å¯¼å…¥"
4. æ£€æŸ¥Ankiä¸­å¯¼å…¥çš„å¡ç‰‡

### é¢„æœŸç»“æœ
- âœ… å¯¼å…¥çš„å¡ç‰‡åº”è¯¥æ˜¯ `comparability`
- âœ… å¡ç‰‡å†…å®¹åº”è¯¥æ˜¯ `comparability` çš„ç¿»è¯‘ç»“æœ
- âœ… ä¸åº”è¯¥å‡ºç° `consequence` çš„å†…å®¹

### æµ‹è¯•è„šæœ¬
```bash
cd translation_tool
python3 æµ‹è¯•ç¿»è¯‘å¯¼å…¥ä¿®å¤.py
```

## ä»£ç å˜æ›´æ€»ç»“

### æ–°å¢ä»£ç 
```python
# 1. åˆå§‹åŒ–ä¸­æ·»åŠ æ ‡å¿—
self.auto_import_after_translation = False

# 2. é‡æ–°è®¾è®¡çš„ translate_and_import æ–¹æ³•
def translate_and_import(self):
    text = self.input_entry.get().strip()
    if not text:
        messagebox.showwarning("æç¤º", "è¯·è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹")
        return
    
    self.auto_import_after_translation = True
    self.smart_translate()

# 3. ç¿»è¯‘å®Œæˆåçš„è‡ªåŠ¨å¯¼å…¥é€»è¾‘
if self.auto_import_after_translation:
    self.auto_import_after_translation = False
    self.root.after(500, self.add_to_anki)
```

### åˆ é™¤ä»£ç 
```python
# åˆ é™¤äº†æœ‰é—®é¢˜çš„é€»è¾‘
# if self.current_translation:
#     self.root.after(1000, self.add_to_anki)
```

## å½±å“èŒƒå›´

### å—å½±å“åŠŸèƒ½
- âœ… "ç¿»è¯‘+å¯¼å…¥"æŒ‰é’® - ä¸»è¦ä¿®å¤ç›®æ ‡
- âœ… å¼‚æ­¥ç¿»è¯‘æµç¨‹ - å¢å¼ºäº†çŠ¶æ€ç®¡ç†
- âœ… é”™è¯¯å¤„ç† - æ›´åŠ å¥å£®

### ä¸å—å½±å“åŠŸèƒ½
- âœ… "æ™ºèƒ½ç¿»è¯‘"æŒ‰é’® - åŠŸèƒ½ä¸å˜
- âœ… "æ·»åŠ åˆ°Anki"æŒ‰é’® - åŠŸèƒ½ä¸å˜
- âœ… å…¶ä»–ç•Œé¢åŠŸèƒ½ - åŠŸèƒ½ä¸å˜

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### ä¿®å¤å‰
- âŒ ç”¨æˆ·å›°æƒ‘ï¼šä¸ºä»€ä¹ˆå¯¼å…¥çš„ä¸æ˜¯å½“å‰å•è¯ï¼Ÿ
- âŒ éœ€è¦æ‰‹åŠ¨é‡æ–°å¯¼å…¥æ­£ç¡®çš„å•è¯
- âŒ å½±å“å­¦ä¹ æ•ˆç‡å’Œç”¨æˆ·ä¿¡ä»»

### ä¿®å¤å
- âœ… è¡Œä¸ºç¬¦åˆé¢„æœŸï¼šå¯¼å…¥å½“å‰ç¿»è¯‘çš„å•è¯
- âœ… ä¸€é”®æ“ä½œçœŸæ­£å®ç°ï¼šç¿»è¯‘+å¯¼å…¥ä¸€æ­¥å®Œæˆ
- âœ… æå‡ç”¨æˆ·ä½“éªŒå’Œå·¥ä½œæ•ˆç‡

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025å¹´1æœˆ8æ—¥  
**é—®é¢˜ç±»å‹**: å¼‚æ­¥æ—¶åºé—®é¢˜  
**ä¿®å¤æ–¹å¼**: çŠ¶æ€æ ‡å¿— + å›è°ƒæœºåˆ¶  
**æµ‹è¯•çŠ¶æ€**: å¾…ç”¨æˆ·éªŒè¯